<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Upload Movie to MinIO</title>
  </head>
  <body>
    <h2>üé¨ Upload Movie to MinIO (with backend + signed URL)</h2>

    <input type="file" id="fileInput" accept="video/mp4" />
    <button onclick="uploadMovie()">Upload</button>

    <p id="status"></p>

    <script>
      async function uploadMovie() {
        const fileInput = document.getElementById('fileInput');
        const file = fileInput.files[0];

        if (!file) {
          alert('Please select a video file!');
          return;
        }

        const requestBody = {
          title: 'Inception',
          description: 'A mind-bending thriller about dreams within dreams.',
          releaseDate: '2010-07-16T00:00:00Z',
          genres: ['ACTION', 'HORROR'],
          actorIds: ['f08e232f-0fe9-471b-b0ad-402c12418f33'],
          thumbnailUrl: 'https://example.com/inception-thumbnail.jpg',
          movieFileName: 'inception-1080p.mp4',
          isPublic: true,
        };

        const backendRes = await fetch('http://localhost:8080/movies/upload', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(requestBody),
        });

        if (!backendRes.ok) {
          document.getElementById('status').innerText =
            '‚ùå Failed to create movie or get signed URL';
          return;
        }

        const data = await backendRes.json();

        const signedUrl = data.uploadUrl;

        const uploadRes = await fetch(signedUrl, {
          method: 'PUT',
          body: file,
          headers: {
            'Content-Type': file.type,
          },
        });

        if (uploadRes.ok) {
          document.getElementById('status').innerText =
            '‚úÖ Movie uploaded successfully!';
        } else {
          document.getElementById('status').innerText =
            '‚ùå Failed to upload video file to MinIO!';
        }
      }
    </script>
  </body>
</html>
